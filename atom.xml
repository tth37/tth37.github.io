<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>tth37&#39;s Blog</title>
  
  <subtitle>Think twice, Code once</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tth37.cn/"/>
  <updated>2020-10-24T18:17:37.463Z</updated>
  <id>https://tth37.cn/</id>
  
  <author>
    <name>tth37</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>「计蒜客模拟赛」魔法阵</title>
    <link href="https://tth37.cn/2020/10/25/solution-jsk-48956/"/>
    <id>https://tth37.cn/2020/10/25/solution-jsk-48956/</id>
    <published>2020-10-24T17:48:09.000Z</published>
    <updated>2020-10-24T18:17:37.463Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/48956" target="_blank" rel="noopener">#48956. 「计蒜客模拟赛」魔法阵</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>$n$ 个有编号的球放到有编号的环上，球分黑白两色，共 $k$ 个白球。要求至少有 $d$ 对黑球相邻，求方案数。</p><p>$n\le 1000000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>可以将编号为 $1..k$ 的小球视为相同的白球，将编号为 $k+1..n$ 的小球视为相同的黑球，在统计答案时乘上 $k!(n-k)!$ 即可。</p><p>可以将环视为无编号的环，在统计答案时乘上 $n$ 即可。</p><p>注意到“断开的边”只会在<strong>一段相邻的白球</strong>之间产生，将<strong>一段相邻的白球</strong>称为一个连通块。设有 $p$ 个连通块，则“断开的边”的数量为 $n-k-p$。根据题目条件 $n-k-p\ge d$，得 $p\le n-k-d$。因此从 $1$ 到 $n-k-d$ 枚举连通块数量。</p><p>对于枚举到的 $p$，用<strong>隔板法</strong>将黑球和白球分成 $p$ 段，并将它们摆放在无编号的环上。可以发现，每种方案会被重复统计 $p$ 次，故两次隔板法求得的方案数需要再除以 $p$。</p><p>最后将统计得到的答案乘上 $n\times k!(n-k)!$ 即可。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>需要特殊讨论 $k=1$ 和 $k=n$ 的情形，因为黑/白球个数为零，无法划分为连通块。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> ll MOD = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line">ll fac[MAXN], inv[MAXN], facinv[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">C</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[n] * facinv[k] % MOD * facinv[n - k] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t, n, k, d;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"ring.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"ring.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    fac[<span class="number">0</span>] = facinv[<span class="number">0</span>] = fac[<span class="number">1</span>] = inv[<span class="number">1</span>] = facinv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">1000000</span>; ++i) &#123;</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * i * fac[i - <span class="number">1</span>] % MOD;</span><br><span class="line">        inv[i] = (MOD - MOD / i) * inv[MOD % i] % MOD;</span><br><span class="line">        facinv[i] = inv[i] * facinv[i - <span class="number">1</span>] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;k, &amp;d);</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, fac[n]);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k == n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, fac[n]);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"0\n"</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">1</span>; p &lt;= n - k - d; ++p) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; k || p &gt; n - k) <span class="keyword">break</span>;</span><br><span class="line">            ans = (ans + C(n - k - <span class="number">1</span>, p - <span class="number">1</span>) * C(k - <span class="number">1</span>, p - <span class="number">1</span>) % MOD * inv[p] % MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="number">1l</span>l * n * ans % MOD;</span><br><span class="line">        ans = ans * fac[k] % MOD * fac[n - k] % MOD;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/48956&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#48956. 「计蒜客模拟赛」魔法阵&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;$n$ 个有编号的球放到有编号的环上，球分黑白两色，共 $k$ 个白球。要求至少有 $d$ 对黑球相邻，求方案数。&lt;/p&gt;
&lt;p&gt;$n\le 1000000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="组合计数" scheme="https://tth37.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0/"/>
    
      <category term="数学" scheme="https://tth37.cn/tags/%E6%95%B0%E5%AD%A6/"/>
    
      <category term="乘法逆元" scheme="https://tth37.cn/tags/%E4%B9%98%E6%B3%95%E9%80%86%E5%85%83/"/>
    
      <category term="组合数" scheme="https://tth37.cn/tags/%E7%BB%84%E5%90%88%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客模拟赛」魔镜啊魔镜</title>
    <link href="https://tth37.cn/2020/10/24/solution-jsk-t3252/"/>
    <id>https://tth37.cn/2020/10/24/solution-jsk-t3252/</id>
    <published>2020-10-24T14:46:04.000Z</published>
    <updated>2020-10-24T14:55:49.843Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/T3252" target="_blank" rel="noopener">#T3252. 「计蒜客模拟赛」魔镜啊魔镜</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>一棵 $n$ 个节点的树，给定 $m$ 个标记链。进行 $q$ 次询问，每次询问 $(u,v)$ 链上有多少条标记链。</p><p>$n\le 100000,m\le 100000,q\le 100000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>以 $1$ 为根，预处理 $\text{dfs}$ 序。</p><p>对于一条标记链 $(u,v)$，如果 $u$、$v$ 存在祖孙关系，则可以推出，如果查询链 $(x,y)$ 完全包含 $(u,v)$，则 $x$、$y$ 分别属于某个区间中。</p><p>如果 $u$、$v$ 不存在祖孙关系，则 $x$、$y$ 同样分属在两个区间中。</p><p>二维偏序即可处理。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, val, op, idx; <span class="comment">// 0: modify  1: query</span></span><br><span class="line">&#125; node[MAXN &lt;&lt; <span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> node_idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(Node a, Node b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.x != b.x) <span class="keyword">return</span> a.x &lt; b.x;</span><br><span class="line">    <span class="keyword">if</span> (a.y != b.y) <span class="keyword">return</span> a.y &lt; b.y;</span><br><span class="line">    <span class="keyword">return</span> a.op &lt; b.op;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q;</span><br><span class="line"><span class="keyword">int</span> c[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; p &lt;= n; p += p &amp; (-p)) </span><br><span class="line">        c[p] += val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; p; p -= p &amp; (-p))</span><br><span class="line">        ret += c[p];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[MAXN][<span class="number">18</span>], dep[MAXN], dfn[MAXN], siz[MAXN], dfn_idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    f[u][<span class="number">0</span>] = fa, dep[u] = dep[fa] + <span class="number">1</span>, dfn[u] = ++dfn_idx, siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">17</span>; ++i)</span><br><span class="line">        f[u][i] = f[f[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it = G[u].begin(); it != G[u].end(); it++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = *it;</span><br><span class="line">        <span class="keyword">if</span> (v == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v]) swap(u, v);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">17</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        <span class="keyword">if</span> (dep[f[u][i]] &gt;= dep[v]) u = f[u][i];</span><br><span class="line">    <span class="keyword">if</span> (u == v) <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">17</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        <span class="keyword">if</span> (f[u][i] != f[v][i]) u = f[u][i], v = f[v][i];</span><br><span class="line">    <span class="keyword">return</span> f[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (d) &#123;</span><br><span class="line">        <span class="keyword">if</span> (d &amp; <span class="number">1</span>) u = f[u][k];</span><br><span class="line">        k++;</span><br><span class="line">        d &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"mirror.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"mirror.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">        G[u].push_back(v), G[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">        <span class="keyword">int</span> t = lca(u, v);</span><br><span class="line">        <span class="keyword">if</span> (t == u || t == v) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dep[u] &lt; dep[v]) swap(u, v); <span class="comment">// u is deeper</span></span><br><span class="line">            <span class="keyword">int</span> w = jump(u, dep[u] - dep[v] - <span class="number">1</span>); <span class="comment">// jump to v's son</span></span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u], <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u], dfn[w], <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u], dfn[w] + siz[w], <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u] + siz[u], <span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u] + siz[u], dfn[w], <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u] + siz[u], dfn[w] + siz[w], <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u], dfn[v], <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u], dfn[v] + siz[v], <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u] + siz[u], dfn[v], <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            node[++node_idx] = (Node) &#123;dfn[u] + siz[u], dfn[v] + siz[v], <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">        node[++node_idx] = (Node) &#123;dfn[u], dfn[v], <span class="number">0</span>, <span class="number">1</span>, i&#125;;</span><br><span class="line">        node[++node_idx] = (Node) &#123;dfn[v], dfn[u], <span class="number">0</span>, <span class="number">1</span>, i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(node + <span class="number">1</span>, node + node_idx + <span class="number">1</span>, cmp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= node_idx; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node[i].op == <span class="number">1</span>) &#123;</span><br><span class="line">            ans[node[i].idx] += query(node[i].y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            modify(node[i].y, node[i].val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; ++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/T3252&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#T3252. 「计蒜客模拟赛」魔镜啊魔镜&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;一棵 $n$ 个节点的树，给定 $m$ 个标记链。进行 $q$ 次询问，每次询问 $(u,v)$ 链上有多少条标记链。&lt;/p&gt;
&lt;p&gt;$n\le 100000,m\le 100000,q\le 100000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="dfs序" scheme="https://tth37.cn/tags/dfs%E5%BA%8F/"/>
    
      <category term="树状数组" scheme="https://tth37.cn/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="二维偏序" scheme="https://tth37.cn/tags/%E4%BA%8C%E7%BB%B4%E5%81%8F%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客模拟赛」新年炸裂</title>
    <link href="https://tth37.cn/2020/10/24/solution-jsk-t3253/"/>
    <id>https://tth37.cn/2020/10/24/solution-jsk-t3253/</id>
    <published>2020-10-23T16:02:03.000Z</published>
    <updated>2020-10-23T16:17:15.573Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/T3253" target="_blank" rel="noopener">#T3253. 「计蒜客模拟赛」新年炸裂</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>$n$ 个点、$m$ 条边的带权无向图，求从节点 $1$ 回到节点 $1$ 且不走回头路的最短路。</p><p>$n\le 10000,m\le 40000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="50pts"><a href="#50pts" class="headerlink" title="50pts"></a>50pts</h4><p>枚举第一条路走了哪条边，重新建图并将该边删掉，跑最短路即可。</p><p>时间复杂度 $O(n^2\log n)$。</p><h4 id="100pts"><a href="#100pts" class="headerlink" title="100pts"></a>100pts</h4><p><strong>本解法由 swt 提供，爆踩标算。</strong></p><p>求出以 $1$ 为根的<strong>最短路生成树</strong>。容易发现，最短环状路径需要经过至少一条非树边。</p><p>枚举所有非树边。可以结合最短路树的性质证明，若非树边的两端点在根节点的同一子树内，则该边一定不在最短环状路径中；若在两个不同子树内，则经过该边的最短环状路径长度一定为 $d_u+d_v+w_{u,v}$。更新答案即可。</p><p>时间复杂度 $O(n\log n)$。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10000</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">40000</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">1e15</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nxt;</span><br><span class="line">    ll w;</span><br><span class="line">&#125; edge[MAXM &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge2</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nxt;</span><br><span class="line">&#125; edge2[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[MAXN], head2[MAXN], cnt, cnt2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, ll w)</span> </span>&#123;</span><br><span class="line">    edge[++cnt].v = v;</span><br><span class="line">    edge[cnt].w = w;</span><br><span class="line">    edge[cnt].nxt = head[u];</span><br><span class="line">    head[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    edge2[++cnt2].v = v;</span><br><span class="line">    edge2[cnt2].nxt = head2[u];</span><br><span class="line">    head2[u] = cnt2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t, n, m;</span><br><span class="line"></span><br><span class="line">ll d[MAXN];</span><br><span class="line"><span class="keyword">int</span> fa[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        d[i] = INF;</span><br><span class="line">        vis[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    d[s] = <span class="number">0</span>;</span><br><span class="line">    priority_queue&lt;pair&lt;ll, <span class="keyword">int</span>&gt; &gt; q;</span><br><span class="line">    q.push(make_pair(<span class="number">0</span>, s));</span><br><span class="line">    <span class="keyword">while</span> (q.size()) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.top().second;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span> (vis[u]) <span class="keyword">continue</span>;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            ll w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (d[v] == INF || d[u] + w &lt; d[v]) &#123;</span><br><span class="line">                fa[v] = u;</span><br><span class="line">                d[v] = d[u] + w;</span><br><span class="line">                q.push(make_pair(<span class="number">-1</span> * d[v], v));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == <span class="number">1</span> || fa[u] == <span class="number">1</span>) c[u] = u;</span><br><span class="line">    <span class="keyword">else</span> c[u] = c[fa[u]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head2[u]; i; i = edge2[i].nxt) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge2[i].v;</span><br><span class="line">        dfs(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"burst.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"burst.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            ll w;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%lld"</span>, &amp;u, &amp;v, &amp;w);</span><br><span class="line">            AddEdge(u, v, w), AddEdge(v, u, w);</span><br><span class="line">        &#125;</span><br><span class="line">        Dijkstra(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) AddEdge2(fa[i], i);</span><br><span class="line">        dfs(<span class="number">1</span>); <span class="comment">// Paint</span></span><br><span class="line">        ll ans = INF;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line">                <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">                ll w = edge[i].w;</span><br><span class="line">                <span class="keyword">if</span> (fa[u] == v || fa[v] == u) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (c[u] == c[v]) <span class="keyword">continue</span>;</span><br><span class="line">                ans = min(ans, d[u] + d[v] + w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ans == INF) <span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">        cnt = cnt2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) head[i] = head2[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/T3253&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#T3253. 「计蒜客模拟赛」新年炸裂&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;$n$ 个点、$m$ 条边的带权无向图，求从节点 $1$ 回到节点 $1$ 且不走回头路的最短路。&lt;/p&gt;
&lt;p&gt;$n\le 10000,m\le 40000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="最短路" scheme="https://tth37.cn/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/"/>
    
      <category term="最短路树" scheme="https://tth37.cn/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客模拟赛」自适应平衡多叉处理数据结构</title>
    <link href="https://tth37.cn/2020/10/18/solution-jsk-t3244/"/>
    <id>https://tth37.cn/2020/10/18/solution-jsk-t3244/</id>
    <published>2020-10-18T15:47:38.000Z</published>
    <updated>2020-10-23T16:03:53.775Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/T3244" target="_blank" rel="noopener">#T3244. 「计蒜客模拟赛」自适应平衡多叉处理数据结构</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>维护数据结构，每次询问时执行 $O(\sqrt n)$ 次查询操作，每次修改执行一次修改操作。</p><p>$n\le 300000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="50pts"><a href="#50pts" class="headerlink" title="50pts"></a>50pts</h4><p>观察到每次前移 $i$ 步时，下一步停止或前移 $i+1$ 步。因此前移次数不超过 $\sqrt t$ 次。</p><p>维护树状数组，$O(\log n)$ 修改，$O(\log n)$ 查询。时间复杂度 $O(n\log n\sqrt n)$。</p><h4 id="100pts"><a href="#100pts" class="headerlink" title="100pts"></a>100pts</h4><p>使用 <a href="https://yangjijingru.com/2018/02/03/%E5%88%86%E5%9D%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">根号平衡</a> 优化数据结构，$O(\sqrt n)$ 修改，$O(1)$ 查询。时间复杂度 $O(n\sqrt n)$</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p><strong>使用分块思想处理修改-查询操作序列</strong></p><ul><li><p>均摊复杂度</p><p>  参考 <a href="https://tth37.cn/2020/03/01/solution-jsk-6012B/">「计蒜客 2020.2 提高组」保卫水库</a>。</p><p>  适用条件：修改操作具有<strong>可累加性</strong>。</p><p>  对于查询操作，将其之前的所有修改操作单独处理均需 $O(1)$ 复杂度；也可将所有修改操作全局标记，需要 $O(n)$ 复杂度。</p><p>  考虑维护一个修改操作集合。查询操作将操作集合中的所有修改操作单独处理。当操作集合大小达到 $\sqrt n$ 时，进行一次全局标记并清空集合。</p><p>  均摊时间复杂度 $O(n\sqrt n)$。</p></li><li><p>根号平衡</p><p>  通过降低修改复杂度、提高查询复杂度，或降低查询复杂度、提高修改复杂度，以达到平衡，取得最优全局复杂度。</p></li></ul><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t, q, l; <span class="comment">//tql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[MAXN], d[MAXN];</span><br><span class="line"><span class="comment">// s[i] = c[i] + d[i / l]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t1 = (p / l + <span class="number">1</span>) * l - <span class="number">1</span>;</span><br><span class="line">    t1 = min(t1, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = p; i &lt;= t1; ++i)</span><br><span class="line">        c[i]++;</span><br><span class="line">    <span class="keyword">int</span> t2 = t / l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = p / l + <span class="number">1</span>; i &lt;= t2; ++i)</span><br><span class="line">        d[i]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c[p] + d[p / l];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"task.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"task.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;t, &amp;q);</span><br><span class="line">    l = <span class="built_in">sqrt</span>(t);</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="keyword">int</span> tp, cur;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;tp, &amp;cur);</span><br><span class="line">        <span class="keyword">if</span> (tp == <span class="number">0</span>) &#123;</span><br><span class="line">            modify(cur);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> stp = <span class="number">0</span>, lst = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> t1 = query(cur), t2 = query(lst);</span><br><span class="line">                stp = t1 - t2;</span><br><span class="line">                <span class="keyword">if</span> (!stp) <span class="keyword">break</span>;</span><br><span class="line">                lst = cur, cur += t1;</span><br><span class="line">                <span class="keyword">if</span> (cur &gt; t) &#123;</span><br><span class="line">                    cur = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, cur);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/T3244&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#T3244. 「计蒜客模拟赛」自适应平衡多叉处理数据结构&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;维护数据结构，每次询问时执行 $O(\sqrt n)$ 次查询操作，每次修改执行一次修改操作。&lt;/p&gt;
&lt;p&gt;$n\le 300000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="分块" scheme="https://tth37.cn/tags/%E5%88%86%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>「CSP-S 2019」Emiya 家今天的饭</title>
    <link href="https://tth37.cn/2020/03/13/solution-loj-3211/"/>
    <id>https://tth37.cn/2020/03/13/solution-loj-3211/</id>
    <published>2020-03-13T15:22:20.000Z</published>
    <updated>2020-03-16T09:09:46.111Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://loj.ac/problem/3211" target="_blank" rel="noopener">#3211. 「CSP-S 2019」Emiya 家今天的饭</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>在 $n\times m$ 的矩阵中选 $k$ 个元素，要求 $k\ge 1$，每行最多选 $1$ 个元素，每列元素个数不超过 $\lfloor \frac{k}{2}\rfloor$ 的方案数。</p><p>$n\le 100,m\le 2000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="84-pts"><a href="#84-pts" class="headerlink" title="84 pts"></a>84 pts</h4><p>注意到如果某一列不符合条件 3，则其他列必然都符合。</p><p>可以先不考虑条件 3，用背包动态规划计算出所有可行方案数。然后枚举不符合条件的列，设其编号为 $c$；记 $f[i][j][k]$ 为在前 $i$ 行中选出 $j$ 个物品，且第 $c$ 列恰好选了 $k$ 个的方案数。</p><p>时间复杂度 $O(n^3m)$，可以得到 84 分。</p><h4 id="100-pts"><a href="#100-pts" class="headerlink" title="100 pts"></a>100 pts</h4><p>优化第二个动态规划，记 $f[i][j]$ 为在前 $i$ 行中，在第 $c$ 列中选出的物品比其他物品个数多 $j$ 的方案数，即可优化一维。</p><p>事件复杂度 $O(n^2m)$，可以得到 100 分。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>推性质，不能无脑设计状态然后优化。一定要依赖性质。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">105</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">2005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">ll a[MAXN][MAXM], s[MAXN];</span><br><span class="line">ll f[MAXN][MAXN * <span class="number">2</span>], g[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"meal.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"meal.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;a[i][j]), s[i] = (s[i] + a[i][j]) % MOD;</span><br><span class="line">    g[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= <span class="number">1</span>; --j) g[j] = (g[j] + g[j - <span class="number">1</span>] * s[i] % MOD) % MOD;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) ans = (ans + g[i]) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">1</span>; c &lt;= m; ++c) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f));</span><br><span class="line">        f[<span class="number">0</span>][n] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">2</span> * n; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == <span class="number">0</span>)</span><br><span class="line">                    f[i][j] = (f[i - <span class="number">1</span>][j] + f[i - <span class="number">1</span>][j + <span class="number">1</span>] * (s[i] - a[i][c] + MOD) % MOD) % MOD;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    f[i][j] = (f[i - <span class="number">1</span>][j] + f[i - <span class="number">1</span>][j + <span class="number">1</span>] * (s[i] - a[i][c] + MOD) % MOD +</span><br><span class="line">                               f[i - <span class="number">1</span>][j - <span class="number">1</span>] * a[i][c] % MOD) %</span><br><span class="line">                              MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) ans = (ans - f[n][n + i] + MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://loj.ac/problem/3211&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#3211. 「CSP-S 2019」Emiya 家今天的饭&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;在 $n\times m$ 的矩阵中选 $k$ 个元素，要求 $k\ge 1$，每行最多选 $1$ 个元素，每列元素个数不超过 $\lfloor \frac{k}{2}\rfloor$ 的方案数。&lt;/p&gt;
&lt;p&gt;$n\le 100,m\le 2000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="LibreOJ" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/"/>
    
    
      <category term="组合计数" scheme="https://tth37.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0/"/>
    
      <category term="动态规划" scheme="https://tth37.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
      <category term="计数dp" scheme="https://tth37.cn/tags/%E8%AE%A1%E6%95%B0dp/"/>
    
  </entry>
  
  <entry>
    <title>「TJOI2019」甲苯先生和大中锋的字符串</title>
    <link href="https://tth37.cn/2020/03/08/solution-loj-3108/"/>
    <id>https://tth37.cn/2020/03/08/solution-loj-3108/</id>
    <published>2020-03-08T15:05:35.000Z</published>
    <updated>2020-03-08T15:13:18.717Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://loj.ac/problem/3108" target="_blank" rel="noopener">#3108. 「TJOI2019」甲苯先生和大中锋的字符串</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>给定字符串 $s$，求出 $s$ 恰好出现 $k$ 次的子串中长度中出现次数最多的长度数。</p><p>$|s|\le 100000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>对原串建立后缀自动机。</p><p>可以通过一遍 dfs 求出 $\text{parent}$ 树上每个节点的出现次数。对于出现次数恰好为 $k$ 的节点，则将该节点覆盖的长度区间加一，可以用差分数组处理。</p><p>在差分数组中找出答案即可。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>后缀自动机多测清空时注意将 $\text{trans}$ 数组清空，尤其是 $0$ 号节点。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SIGMA = <span class="number">27</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, k;</span><br><span class="line"><span class="keyword">int</span> f[MAXN &lt;&lt; <span class="number">1</span>], s[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SAM</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> len, link;</span><br><span class="line"><span class="keyword">int</span> trans[SIGMA];</span><br><span class="line">&#125; node[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(u) node[u].len</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> link(u) node[u].link</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> trans(u, c) node[u].trans[c]</span></span><br><span class="line"><span class="keyword">int</span> cnt, last;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">len(<span class="number">0</span>) = <span class="number">0</span>;</span><br><span class="line">link(<span class="number">0</span>) = <span class="number">-1</span>;</span><br><span class="line">cnt = <span class="number">0</span>;</span><br><span class="line">last = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIGMA; ++i)</span><br><span class="line">trans(<span class="number">0</span>, i) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> cur = ++cnt;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIGMA; ++i)</span><br><span class="line">trans(cur, i) = <span class="number">0</span>;</span><br><span class="line">len(cur) = len(last) + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> p = last;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; trans(p, c) == <span class="number">0</span>) &#123;</span><br><span class="line">trans(p, c) = cur;</span><br><span class="line">p = link(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p == <span class="number">-1</span>) &#123;</span><br><span class="line">link(cur) = <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> q = trans(p, c);</span><br><span class="line"><span class="keyword">if</span> (len(p) + <span class="number">1</span> == len(q)) &#123;</span><br><span class="line">link(cur) = q;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> clone = ++cnt;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIGMA; ++i)</span><br><span class="line">trans(clone, i) = <span class="number">0</span>;</span><br><span class="line">len(clone) = len(p) + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIGMA; ++i)</span><br><span class="line">trans(clone, i) = trans(q, i);</span><br><span class="line">link(clone) = link(q);</span><br><span class="line"><span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; trans(p, c) == q) &#123;</span><br><span class="line">trans(p, c) = clone;</span><br><span class="line">p = link(p);</span><br><span class="line">&#125;</span><br><span class="line">link(q) = link(cur) = clone;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">f[cur] = <span class="number">1</span>;</span><br><span class="line">last = cur;</span><br><span class="line">&#125;</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> v, nxt;</span><br><span class="line">&#125; edge[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN &lt;&lt; <span class="number">1</span>], cnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">edge[++cnt].v = v;</span><br><span class="line">edge[cnt].nxt = head[u];</span><br><span class="line">head[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line"><span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">dfs(v);</span><br><span class="line">f[u] += f[v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (u == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span> (f[u] == k) &#123;</span><br><span class="line"><span class="keyword">int</span> l = T.node[T.node[u].link].len + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> r = T.node[u].len;</span><br><span class="line">s[l] += <span class="number">1</span>;</span><br><span class="line">s[r + <span class="number">1</span>] -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="keyword">char</span> str[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;t);</span><br><span class="line"><span class="keyword">while</span> (t--) &#123;</span><br><span class="line">T.init();</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>, str + <span class="number">1</span>);</span><br><span class="line">n = <span class="built_in">strlen</span>(str + <span class="number">1</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">T.insert(str[i] - <span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= T.cnt; ++i) &#123;</span><br><span class="line">AddEdge(T.node[i].link, i);</span><br><span class="line">&#125;</span><br><span class="line">dfs(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">-1</span>, ans_val = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">s[i] += s[i - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (s[i] &amp;&amp; s[i] &gt;= ans_val)</span><br><span class="line">ans = i, ans_val = s[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= T.cnt; ++i) &#123;</span><br><span class="line">f[i] = <span class="number">0</span>;</span><br><span class="line">head[i] = <span class="number">0</span>;</span><br><span class="line">s[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cnt = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://loj.ac/problem/3108&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#3108. 「TJOI2019」甲苯先生和大中锋的字符串&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;给定字符串 $s$，求出 $s$ 恰好出现 $k$ 次的子串中长度中出现次数最多的长度数。&lt;/p&gt;
&lt;p&gt;$|s|\le 100000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="LibreOJ" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/"/>
    
    
      <category term="字符串" scheme="https://tth37.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="后缀自动机" scheme="https://tth37.cn/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
      <category term="差分" scheme="https://tth37.cn/tags/%E5%B7%AE%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>后缀自动机</title>
    <link href="https://tth37.cn/2020/03/04/algorithm-sam/"/>
    <id>https://tth37.cn/2020/03/04/algorithm-sam/</id>
    <published>2020-03-04T00:11:47.000Z</published>
    <updated>2020-03-22T14:49:02.214Z</updated>
    
    <content type="html"><![CDATA[<p>刚刚学习了后缀自动机，当然要写一篇算法学习啦。</p><p>占坑，先咕。</p><a id="more"></a><p>后缀自动机是处理一系列字符串问题强有力的工具。</p><p>咕咕咕</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;刚刚学习了后缀自动机，当然要写一篇算法学习啦。&lt;/p&gt;
&lt;p&gt;占坑，先咕。&lt;/p&gt;
    
    </summary>
    
      <category term="算法学习" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="字符串" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
    
      <category term="字符串" scheme="https://tth37.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="后缀自动机" scheme="https://tth37.cn/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客 2020.2 提高组」最强之剑</title>
    <link href="https://tth37.cn/2020/03/01/solution-jsk-6012C/"/>
    <id>https://tth37.cn/2020/03/01/solution-jsk-6012C/</id>
    <published>2020-03-01T15:24:08.000Z</published>
    <updated>2020-03-02T15:00:18.408Z</updated>
    
    <content type="html"><![CDATA[<p><a href></a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>给定 $n$ 种原材料，每种材料有一个特征值 $a_i$ 和强度 $b_i$。有 $q$ 次查询或修改，询问是给出一段区间 $[l,r]$，要求在 $l,l+1..r-1,r$ 的原材料中选出一个特征值线性无关的子集，是强度值之和最大；修改是修改某种原材料的特征值和强度。</p><p>$n\le 100000,q\le 10000,1\le a_i,b_i\le 1000000000$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>将原材料按强度值递减排序，将原材料依次插入线性基中，所得方案为最优方案。贪心证明略。</p><p>对于单次询问，可以建立线段树维护区间信息，写一个合并函数，用相同的贪心策略暴力合并两个线性基。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">L_B</span> &#123;</span></span><br><span class="line">ll a[<span class="number">35</span>], w[<span class="number">35</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i)</span><br><span class="line">a[i] = w[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">insert</span><span class="params">(ll val, ll k)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">31</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line"><span class="keyword">if</span> (val &amp; (<span class="number">1l</span>l &lt;&lt; i)) &#123;</span><br><span class="line"><span class="keyword">if</span> (a[i] == <span class="number">0</span>) &#123;</span><br><span class="line">a[i] = val;</span><br><span class="line">w[i] = k;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">val ^= a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> val &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">sum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ll ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i) </span><br><span class="line"><span class="keyword">if</span> (a[i]) ret += w[i];</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i)</span><br><span class="line"><span class="keyword">if</span> (a[i]) <span class="built_in">printf</span>(<span class="string">"%lld "</span>, a[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">L_B <span class="title">merge</span><span class="params">(L_B A, L_B B)</span> </span>&#123;</span><br><span class="line">pair&lt;ll, ll&gt; tmp[<span class="number">71</span>];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (A.a[i]) tmp[++cnt].first = A.w[i], tmp[cnt].second = A.a[i];</span><br><span class="line"><span class="keyword">if</span> (B.a[i]) tmp[++cnt].first = B.w[i], tmp[cnt].second = B.a[i];</span><br><span class="line">&#125;</span><br><span class="line">sort(tmp + <span class="number">1</span>, tmp + cnt + <span class="number">1</span>);</span><br><span class="line">L_B ret;</span><br><span class="line">ret.clear();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = cnt; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">ret.insert(tmp[i].second, tmp[i].first);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, q;</span><br><span class="line">pair&lt;ll, ll&gt; a[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segment_Tree</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> l, r;</span><br><span class="line">L_B b;</span><br><span class="line">&#125; node[MAXN * <span class="number">3</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> b(u) node[u].b</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson(u) node[u].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson(u) node[u].r</span></span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>, R = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span>&amp; u, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">u = ++cnt;</span><br><span class="line">b(u).clear();</span><br><span class="line"><span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">b(u).insert(a[l].second, a[l].first);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">build(lson(u), l, mid), build(rson(u), mid + <span class="number">1</span>, r);</span><br><span class="line">b(u) = merge(b(lson(u)), b(rson(u)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">L_B <span class="title">query</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) </span><br><span class="line"><span class="keyword">return</span> b(u);</span><br><span class="line"><span class="keyword">if</span> (r &lt; ql || l &gt; qr) &#123;</span><br><span class="line">L_B ret;</span><br><span class="line">ret.clear();</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> merge(query(lson(u), l, mid, ql, qr), query(rson(u), mid + <span class="number">1</span>, r, ql, qr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, ll val, ll k)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">b(u).clear();</span><br><span class="line">b(u).insert(val, k);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (p &lt;= mid) modify(lson(u), l, mid, p, val, k);</span><br><span class="line"><span class="keyword">else</span> modify(rson(u), mid + <span class="number">1</span>, r, p, val, k);</span><br><span class="line">b(u) = merge(b(lson(u)), b(rson(u)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>, &amp;a[i].second, &amp;a[i].first);</span><br><span class="line">T.build(T.R, <span class="number">1</span>, n);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;q);</span><br><span class="line"><span class="keyword">while</span> (q--) &#123;</span><br><span class="line"><span class="keyword">int</span> op;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;op);</span><br><span class="line"><span class="keyword">if</span> (op == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> l, r;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l, &amp;r);</span><br><span class="line">L_B ans = T.query(T.R, <span class="number">1</span>, n, l, r);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, T.query(T.R, <span class="number">1</span>, n, l, r).sum());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> x, a, b;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;a, &amp;b);</span><br><span class="line">T.modify(T.R, <span class="number">1</span>, n, x, a, b);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;给定 $n$ 种原材料，每种材料有一个特征值 $a_i$ 和强度 $b_i$。有 $q$ 次查询或修改，询问是给出一段区间 $[l,r]$，要求在 $l,l+1..r-1,r$ 的原材料中选出一个特征值线性无关的子集，是强度值之和最大；修改是修改某种原材料的特征值和强度。&lt;/p&gt;
&lt;p&gt;$n\le 100000,q\le 10000,1\le a_i,b_i\le 1000000000$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="线段树" scheme="https://tth37.cn/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="异或" scheme="https://tth37.cn/tags/%E5%BC%82%E6%88%96/"/>
    
      <category term="线性基" scheme="https://tth37.cn/tags/%E7%BA%BF%E6%80%A7%E5%9F%BA/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客 2020.2 提高组」保卫水库</title>
    <link href="https://tth37.cn/2020/03/01/solution-jsk-6012B/"/>
    <id>https://tth37.cn/2020/03/01/solution-jsk-6012B/</id>
    <published>2020-03-01T15:23:59.000Z</published>
    <updated>2020-03-02T14:32:11.146Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/43463" target="_blank" rel="noopener">#43463. 「计蒜客 2020.2 提高组」保卫水库</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>给定有 $n$ 个节点和 $m$ 条边的有向无环图。每个节点有一定的水量，每个结点的水在水库被破坏后会均等地沿着出边流向其他节点。给出 $k$ 个操作，要求查询某个节点流入的水量，以及修改某个节点的初始水量。</p><p>$n\le 5000,m\le 10000,k\le 500000$</p><p>测试点的查询和修改次数比例接近 $1:1$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>观察到图为 DAG，并且 $n,n-1..2,1$ 为合法拓扑序。因此可以在图中 $O(n+m)$ 动态规划求出每个城市流入的水量。</p><p>由于在某个城市中增加水量之后，流入下游各个城市的比例是固定的。因此可以预处理这些比值。</p><p>用一个容器存放所有修改改操作，对于查询，计算容器中所有修改操作对其的影响；当容器大小达到某个值 $s$ 时，执行 $O(n+m)$ 的动态规划下放更新。</p><p>复杂度为 $O(sk+\frac{k}{s}(n+m))$，当 $s$ 取 $\sqrt{n+m}$ 时，复杂度取最小值。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>均摊复杂度分析 <a href="/2019/10/14/solution-loj-6515/">「雅礼集训 2018 Day10」贪玩蓝月</a> <a href="/2020/01/20/solution-loj-3227/">「USACO 2019.12 Platinum」Bessie’s Snow Cow</a></p><p>循环时尽量采用 $n\times(n+m)$ 而不是 $(n+m)\times n$</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll MOD = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5005</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll n, ll k)</span> </span>&#123;</span><br><span class="line">ll ret = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (k) &#123;</span><br><span class="line"><span class="keyword">if</span> (k &amp; <span class="number">1</span>) ret = ret * n % MOD;</span><br><span class="line">n = n * n % MOD;</span><br><span class="line">k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, k;</span><br><span class="line"><span class="keyword">int</span> pre[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> c[MAXN];</span><br><span class="line">ll a[MAXN], b[MAXN], d[MAXN], a1[MAXN];</span><br><span class="line">ll f[MAXN][MAXN];</span><br><span class="line"></span><br><span class="line">pair&lt;<span class="keyword">int</span>, ll&gt; s[MAXN];</span><br><span class="line"><span class="keyword">int</span> mx = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> u = n; u &gt;= <span class="number">1</span>; --u) &#123;</span><br><span class="line">b[u] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= c[u]; ++i) &#123;</span><br><span class="line"><span class="keyword">int</span> v = pre[u][i];</span><br><span class="line">b[u] = (b[u] + (a[v] + b[v]) % MOD * d[v] % MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k);</span><br><span class="line">mx = <span class="built_in">sqrt</span>(n + m);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;a1[i]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line"><span class="keyword">int</span> u, v;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line"><span class="keyword">if</span> (u &gt; v) &#123;</span><br><span class="line">pre[v][++c[v]] = u;</span><br><span class="line">d[u]++;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre[u][++c[u]] = v;</span><br><span class="line">d[v]++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">d[i] = qpow(d[i], MOD - <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; ++u) &#123;</span><br><span class="line">    a[u] = <span class="number">1</span>;</span><br><span class="line">    upd();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        f[u][i] = b[i];</span><br><span class="line">    a[u] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memcpy</span>(a, a1, <span class="keyword">sizeof</span>(a));</span><br><span class="line">upd();</span><br><span class="line"><span class="keyword">while</span> (k--) &#123;</span><br><span class="line"><span class="keyword">int</span> op;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;op);</span><br><span class="line"><span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> x, y;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">s[++cnt] = make_pair(x, y);</span><br><span class="line"><span class="keyword">if</span> (cnt == mx) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">                    a[s[i].first] += s[i].second;</span><br><span class="line">                cnt = <span class="number">0</span>;</span><br><span class="line">                upd();</span><br><span class="line">            &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</span><br><span class="line">ll ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++i)</span><br><span class="line">ans = (ans + f[s[i].first][x] * s[i].second % MOD) % MOD;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, (ans + b[x]) % MOD);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/43463&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#43463. 「计蒜客 2020.2 提高组」保卫水库&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;给定有 $n$ 个节点和 $m$ 条边的有向无环图。每个节点有一定的水量，每个结点的水在水库被破坏后会均等地沿着出边流向其他节点。给出 $k$ 个操作，要求查询某个节点流入的水量，以及修改某个节点的初始水量。&lt;/p&gt;
&lt;p&gt;$n\le 5000,m\le 10000,k\le 500000$&lt;/p&gt;
&lt;p&gt;测试点的查询和修改次数比例接近 $1:1$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="动态规划" scheme="https://tth37.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
      <category term="乘法逆元" scheme="https://tth37.cn/tags/%E4%B9%98%E6%B3%95%E9%80%86%E5%85%83/"/>
    
      <category term="复杂度分析" scheme="https://tth37.cn/tags/%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>「计蒜客 2020.2 提高组」受力平衡</title>
    <link href="https://tth37.cn/2020/03/01/solution-jsk-6012A/"/>
    <id>https://tth37.cn/2020/03/01/solution-jsk-6012A/</id>
    <published>2020-03-01T15:23:50.000Z</published>
    <updated>2020-03-01T15:32:06.902Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/43462" target="_blank" rel="noopener">#43462. 「计蒜客 2020.2 提高组」受力平衡</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>题目概括咕咕中~</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h3 id="60pts"><a href="#60pts" class="headerlink" title="60pts"></a>60pts</h3><p>显然答案为 $\sum_{i=1}^{\min(n,m)}{n\choose i}{m\choose i}$</p><h4 id="100pts"><a href="#100pts" class="headerlink" title="100pts"></a>100pts</h4><p>假设取 $i$ 个气球与 $i$ 个重物。考虑取 $i$ 个气球与 $m-i$ 个重物的方案数，与其是一一对应的。因此将题目转化为 <strong>在 $n+m$ 个物品中取 $m$ 个物品</strong> 的方案数，再排除一个气球都不选的方案数即为答案 ${n+m\choose m} -1$</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3e6</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"></span><br><span class="line">ll fac[MAXN], inv[MAXN], facinv[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fac[n] * facinv[m] % MOD * facinv[n - m] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = min(n, m);</span><br><span class="line">    ll ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i)</span><br><span class="line">        ret = (ret + C(n, i) * C(m, i) % MOD) % MOD;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = facinv[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    inv[<span class="number">1</span>] = fac[<span class="number">1</span>] = facinv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">3e6</span>; ++i) &#123;</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % MOD;</span><br><span class="line">        inv[i] = (MOD - MOD / i) * inv[MOD % i] % MOD;</span><br><span class="line">        facinv[i] = facinv[i - <span class="number">1</span>] * inv[i] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="keyword">int</span> x = n + <span class="number">1</span>, y = m + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, C(x + y - <span class="number">2</span>, y - <span class="number">1</span>) - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/43462&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#43462. 「计蒜客 2020.2 提高组」受力平衡&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;题目概括咕咕中~&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="组合计数" scheme="https://tth37.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0/"/>
    
      <category term="数学" scheme="https://tth37.cn/tags/%E6%95%B0%E5%AD%A6/"/>
    
      <category term="组合数" scheme="https://tth37.cn/tags/%E7%BB%84%E5%90%88%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>「雅礼集训 2017 Day8」价</title>
    <link href="https://tth37.cn/2020/02/28/solution-loj-6045/"/>
    <id>https://tth37.cn/2020/02/28/solution-loj-6045/</id>
    <published>2020-02-28T15:16:39.000Z</published>
    <updated>2020-02-28T15:25:00.267Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://loj.ac/problem/6045" target="_blank" rel="noopener">#6045. 「雅礼集训 2017 Day8」价</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>有 $n$ 种药，每种药由若干药材组成，恰好有 $n$ 种不同的药材。要求选出 $k$ 种药，并且使用的药材并集大小也为 $k$，使得药材的权值和最小。</p><p>$n \le 300$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>二分图建模，不同的药向对应的药材连边，边权为无穷大；源点向药连边，边权为 $-p_i$；药材向汇点连边，边权为 $0$。在原图上求最小闭合子图即可。由于存在负权，可以将边权加上 $1e9$ 后再进行操作。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">605</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">605</span> * <span class="number">305</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nxt;</span><br><span class="line">    ll w;</span><br><span class="line">&#125; edge[MAXM &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN], cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> head_or[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, ll w)</span> </span>&#123;</span><br><span class="line">    edge[++cnt].w = w;</span><br><span class="line">    edge[cnt].v = v;</span><br><span class="line">    edge[cnt].nxt = head[u];</span><br><span class="line">    head[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="built_in">memcpy</span>(head, head_or, <span class="keyword">sizeof</span>(head));</span><br><span class="line">    vis[s] = <span class="number">1</span>, d[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="keyword">while</span> (q.size()) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            ll w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || (w == <span class="number">0</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            vis[v] = <span class="number">1</span>;</span><br><span class="line">            d[v] = d[u] + <span class="number">1</span>;</span><br><span class="line">            q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vis[t];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, ll flow)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">    ll rest = flow;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i &amp;&amp; rest; i = edge[i].nxt) &#123;</span><br><span class="line">        head[u] = i;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        ll w = edge[i].w;</span><br><span class="line">        <span class="keyword">if</span> (w == <span class="number">0</span> || d[v] != d[u] + <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        ll tmp = dfs(v, min(rest, w));</span><br><span class="line">        <span class="keyword">if</span> (tmp == <span class="number">0</span>) d[v] = <span class="number">0</span>;</span><br><span class="line">        edge[i].w -= tmp;</span><br><span class="line">        edge[i ^ <span class="number">1</span>].w += tmp;</span><br><span class="line">        rest -= tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow - rest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ret = <span class="number">0</span>, tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (bfs())</span><br><span class="line">        <span class="keyword">while</span> (tmp = dfs(s, INF)) ret += tmp;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">s = <span class="number">2</span> * n + <span class="number">1</span>, t = <span class="number">2</span> * n + <span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line"><span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= k; ++j) &#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</span><br><span class="line">AddEdge(i, n + x, INF);</span><br><span class="line">AddEdge(n + x, i, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ll ans2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line"><span class="keyword">int</span> p;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p);</span><br><span class="line">ans2 += INF - p;</span><br><span class="line">AddEdge(s, i, INF - p);</span><br><span class="line">AddEdge(i, s, <span class="number">0</span>);</span><br><span class="line">AddEdge(n + i, t, INF);</span><br><span class="line">AddEdge(t, n + i, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(head_or, head, <span class="keyword">sizeof</span>(head_or));</span><br><span class="line">ll ans = dinic();</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ans - ans2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://loj.ac/problem/6045&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#6045. 「雅礼集训 2017 Day8」价&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;有 $n$ 种药，每种药由若干药材组成，恰好有 $n$ 种不同的药材。要求选出 $k$ 种药，并且使用的药材并集大小也为 $k$，使得药材的权值和最小。&lt;/p&gt;
&lt;p&gt;$n \le 300$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="LibreOJ" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/"/>
    
      <category term="雅礼集训" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD/"/>
    
    
      <category term="网络流" scheme="https://tth37.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="最小割" scheme="https://tth37.cn/tags/%E6%9C%80%E5%B0%8F%E5%89%B2/"/>
    
  </entry>
  
  <entry>
    <title>计算几何基础</title>
    <link href="https://tth37.cn/2020/02/07/algorithm-geometry/"/>
    <id>https://tth37.cn/2020/02/07/algorithm-geometry/</id>
    <published>2020-02-07T00:31:40.000Z</published>
    <updated>2020-02-07T00:48:42.736Z</updated>
    
    <content type="html"><![CDATA[<p>计算几何是什么呢？</p><a id="more"></a><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> &#123;</span></span><br><span class="line"><span class="keyword">double</span> x, y;</span><br><span class="line">Point(<span class="keyword">double</span> x = <span class="number">0</span>, <span class="keyword">double</span> y = <span class="number">0</span>):x(x), y(y) &#123; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line"></span><br><span class="line">Vector <span class="keyword">operator</span> + (Vector A, Vector B) &#123;</span><br><span class="line"><span class="keyword">return</span> Vector(A.x + B.x, A.y + B.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector <span class="keyword">operator</span> - (Vector A, Vector B) &#123;</span><br><span class="line"><span class="keyword">return</span> Vector(A.x - B.x, A.y - B.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector <span class="keyword">operator</span> * (Vector A, <span class="keyword">double</span> p) &#123;</span><br><span class="line"><span class="keyword">return</span> Vector(A.x * p, A.y * p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector <span class="keyword">operator</span> / (Vector A, <span class="keyword">double</span> p) &#123;</span><br><span class="line"><span class="keyword">return</span> Vector(A.x / p, A.y / p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> EPS = <span class="number">1e-10</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dcmp</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt; EPS) <span class="keyword">return</span> <span class="number">0</span>; <span class="keyword">else</span> <span class="keyword">return</span> x &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> == (Vector A, Vector B) &#123;</span><br><span class="line"><span class="keyword">return</span> dcmp(A.x - B.x) == <span class="number">0</span> &amp;&amp; dcmp(A.y - B.y) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Cross</span><span class="params">(Vector A, Vector B)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> A.x * B.y - A.y * B.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Dot</span><span class="params">(Vector A, Vector B)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> A.x * B.x + A.y * B.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Length</span><span class="params">(Vector A)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sqrt</span>(Dot(A, A));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Point <span class="title">GetLineIntersection</span><span class="params">(Point P, Vector v, Point Q, Vector w)</span> </span>&#123;</span><br><span class="line">Vector u = P - Q;</span><br><span class="line"><span class="keyword">double</span> t = Cross(w, u) / Cross(v, w);</span><br><span class="line"><span class="keyword">return</span> P + v * t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Angle</span><span class="params">(Vector A, Vector B)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">acos</span>(Dot(A, B) / Length(A) / Length(B));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(Vector A, <span class="keyword">double</span> rad)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Vector(A.x * <span class="built_in">cos</span>(rad) - A.y * <span class="built_in">sin</span>(rad), A.x * <span class="built_in">sin</span>(rad) + A.y * <span class="built_in">cos</span>(rad));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">DistanceToSegment</span><span class="params">(Point P, Point A, Point B)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (A == B) <span class="keyword">return</span> Length(P - A);</span><br><span class="line">    Vector v1 = B - A, v2 = P - A, v3 = P - B;</span><br><span class="line">    <span class="keyword">if</span> (dcmp(Dot(v1, v2)) &lt; <span class="number">0</span>) <span class="keyword">return</span> length(v2);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (demp(Dot(v1, v3)) &lt; <span class="number">0</span>) <span class="keyword">return</span> length(v3);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">fabs</span>(Cross(v1, v2)) / Length(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;计算几何是什么呢？&lt;/p&gt;
    
    </summary>
    
      <category term="算法学习" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="计算几何" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/"/>
    
    
      <category term="计算几何" scheme="https://tth37.cn/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>「SNOI2019」通信</title>
    <link href="https://tth37.cn/2020/02/01/solution-loj-3097/"/>
    <id>https://tth37.cn/2020/02/01/solution-loj-3097/</id>
    <published>2020-01-31T21:47:29.000Z</published>
    <updated>2020-01-31T21:55:18.948Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://loj.ac/problem/3097" target="_blank" rel="noopener">#3097. 「SNOI2019」通信</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>题目概括咕咕咕（这个好写！）</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>可以参考 <a href="https://tth37.cn/2019/10/22/solution-loj-2255/">「SNOI2017」炸弹</a> 的解法，线段树优化建图。</p><p>本题只需扩展一个维度，用类似可持久化线段树的东西优化建图即可。</p><p>网络流建模最小权路径覆盖。</p><p>代码极端毒瘤且致郁。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> id(x) (lower_bound(b + 1, b + L + 1, x) - b)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rid(x) b[x]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson(x) node[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson(x) node[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> node_id(x) node[x].node_id</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sum(x) node[x].sum</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>, ll&gt; pii;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">50005</span>;</span><br><span class="line"><span class="keyword">int</span> cnt_node = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">namespace</span> MCMF &#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> u, v, val, <span class="built_in">cos</span>, next;</span><br><span class="line">&#125; e[MAXM * <span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, t = <span class="number">1</span>, Head[MAXN], v[MAXN], S, T;</span><br><span class="line"><span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">ll d[MAXN], Delta;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;  </span><br><span class="line">    e[++t] = (Edge)&#123; x, y, v, c, Head[x] &#125;, Head[x] = t;</span><br><span class="line">    e[++t] = (Edge)&#123; y, x, <span class="number">0</span>, -c, Head[y] &#125;, Head[y] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">Relabel</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    <span class="built_in">memset</span>(v, <span class="number">0</span>, <span class="keyword">sizeof</span> v);</span><br><span class="line">    d[T] = <span class="number">0</span>, v[T] = <span class="number">1</span>, q.push_front(T);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop_front(), v[x] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (q.size() &gt; <span class="number">1</span> &amp;&amp; d[q.front()] &gt; d[q.back()])</span><br><span class="line">            swap(q.front(), q.back());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = Head[x], y; i; i = e[i].next)</span><br><span class="line">            <span class="keyword">if</span> (e[i ^ <span class="number">1</span>].val &amp;&amp; d[y = e[i].v] &gt; d[x] + e[i ^ <span class="number">1</span>].<span class="built_in">cos</span>) &#123;</span><br><span class="line">                d[y] = d[x] + e[i ^ <span class="number">1</span>].<span class="built_in">cos</span>;</span><br><span class="line">                <span class="keyword">if</span> (v[y])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                v[y] = <span class="literal">true</span>, q.push_back(y);</span><br><span class="line">                <span class="keyword">if</span> (q.size() &gt; <span class="number">1</span> &amp;&amp; d[q.front()] &gt; d[q.back()])</span><br><span class="line">                    swap(q.front(), q.back());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[S] != d[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">Dinic</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!flow || x == T)</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> residue = flow;</span><br><span class="line">    v[x] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = Head[x], y; i; i = e[i].next)</span><br><span class="line">        <span class="keyword">if</span> (e[i].val &amp;&amp; !v[y = e[i].v] &amp;&amp; !e[i].<span class="built_in">cos</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> k = Dinic(y, min(e[i].val, residue));</span><br><span class="line">            e[i].val -= k, e[i ^ <span class="number">1</span>].val += k;</span><br><span class="line">            <span class="keyword">if</span> ((residue -= k) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> flow - residue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> pii <span class="title">PrimalDual</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Maxflow = <span class="number">0</span>;</span><br><span class="line">    ll Mincost = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (Relabel()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= t; i++) e[i].<span class="built_in">cos</span> += d[e[i].v] - d[e[i].u];</span><br><span class="line">        Delta += d[S];</span><br><span class="line">        <span class="keyword">int</span> Flow = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">memset</span>(v, <span class="number">0x00</span>, <span class="keyword">sizeof</span> v), (Flow = Dinic(S, INF)))</span><br><span class="line">            Maxflow += Flow, Mincost += <span class="number">1l</span>l * Flow * Delta;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pii(Maxflow, Mincost);</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// namespace MCMF</span></span><br><span class="line"><span class="keyword">int</span> n, w;</span><br><span class="line">pair&lt;ll, <span class="keyword">int</span>&gt; a[MAXN];</span><br><span class="line">ll b[MAXN], c[MAXN];</span><br><span class="line"><span class="keyword">int</span> L;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> root0[MAXN], root1[MAXN];</span><br><span class="line"><span class="keyword">int</span> pos0[MAXN], pos1[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, node_id, sum;</span><br><span class="line">&#125; node[MAXN * <span class="number">22</span>];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">bool</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> llen = mid - l + <span class="number">1</span>, rlen = r - mid;</span><br><span class="line">    <span class="keyword">int</span> lsum = sum(lson(u)), rsum = sum(rson(u));</span><br><span class="line">    <span class="keyword">if</span> (lson(u))</span><br><span class="line">        MCMF ::AddEdge(node_id(u), node_id(lson(u)), lsum, llen == <span class="number">1</span> ? (t == <span class="number">0</span> ? -c[l] : c[l]) : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (rson(u))</span><br><span class="line">        MCMF ::AddEdge(node_id(u), node_id(rson(u)), rsum, rlen == <span class="number">1</span> ? (t == <span class="number">0</span> ? -c[r] : c[r]) : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span>&amp; u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">bool</span> t)</span> </span>&#123;</span><br><span class="line">    u = ++cnt;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        sum(u) = <span class="number">1</span>;</span><br><span class="line">        node_id(u) = l;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    node_id(u) = ++cnt_node;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid)</span><br><span class="line">        insert(lson(v), lson(u), l, mid, p, t), rson(u) = rson(v);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        insert(rson(v), rson(u), mid + <span class="number">1</span>, r, p, t), lson(u) = lson(v);</span><br><span class="line">    sum(u) = sum(lson(u)) + sum(rson(u));</span><br><span class="line">    AddEdge(u, l, r, p, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr, <span class="keyword">int</span> cur, <span class="keyword">int</span> num, <span class="keyword">bool</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) &#123;</span><br><span class="line">        MCMF ::AddEdge(cur, node_id(u), sum(u), l == r ? <span class="built_in">abs</span>(c[num] - c[l]) : (t == <span class="number">0</span> ? c[num] : -c[num]));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid)</span><br><span class="line">        query(lson(u), l, mid, ql, qr, cur, num, t);</span><br><span class="line">    <span class="keyword">if</span> (mid &lt; r)</span><br><span class="line">        query(rson(u), mid + <span class="number">1</span>, r, ql, qr, cur, num, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;w);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;a[i].first), b[i] = c[i] = a[i].first, a[i].second = i;</span><br><span class="line">    sort(b + <span class="number">1</span>, b + n + <span class="number">1</span>);</span><br><span class="line">    L = unique(b + <span class="number">1</span>, b + n + <span class="number">1</span>) - b - <span class="number">1</span>;</span><br><span class="line">    sort(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    cnt_node = n;</span><br><span class="line">    root0[<span class="number">0</span>] = ++cnt, node_id(root0[<span class="number">0</span>]) = ++cnt_node;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pos0[id(a[i].first)] = i;</span><br><span class="line">        insert(root0[i - <span class="number">1</span>], root0[i], <span class="number">1</span>, n, a[i].second, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    reverse(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">    root1[<span class="number">0</span>] = ++cnt, node_id(root1[<span class="number">0</span>]) = ++cnt_node;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        pos1[id(a[i].first)] = i;</span><br><span class="line">        insert(root1[i - <span class="number">1</span>], root1[i], <span class="number">1</span>, n, a[i].second, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    MCMF ::S = ++cnt_node, MCMF ::T = ++cnt_node;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        query(root0[pos0[id(c[i])]], <span class="number">1</span>, n, i + <span class="number">1</span>, n, ++cnt_node, i, <span class="number">0</span>);</span><br><span class="line">        query(root1[pos1[id(c[i])]], <span class="number">1</span>, n, i + <span class="number">1</span>, n, cnt_node, i, <span class="number">1</span>);</span><br><span class="line">        MCMF ::AddEdge(MCMF ::S, cnt_node, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        MCMF ::AddEdge(i, MCMF ::T, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        MCMF ::AddEdge(MCMF ::S, i, <span class="number">1</span>, w);</span><br><span class="line">    &#125;</span><br><span class="line">    MCMF ::AddEdge(MCMF ::S, ++cnt_node, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    MCMF ::AddEdge(n, MCMF ::T, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    MCMF ::AddEdge(MCMF ::S, n, <span class="number">1</span>, w);</span><br><span class="line">    pii ans = MCMF ::PrimalDual();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans.second);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://loj.ac/problem/3097&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#3097. 「SNOI2019」通信&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;题目概括咕咕咕（这个好写！）&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="LibreOJ" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/"/>
    
    
      <category term="网络流" scheme="https://tth37.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="主席树" scheme="https://tth37.cn/tags/%E4%B8%BB%E5%B8%AD%E6%A0%91/"/>
    
      <category term="线段树" scheme="https://tth37.cn/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="费用流" scheme="https://tth37.cn/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>「CF1295」Permutation Separation</title>
    <link href="https://tth37.cn/2020/01/31/solution-cf-1295e/"/>
    <id>https://tth37.cn/2020/01/31/solution-cf-1295e/</id>
    <published>2020-01-31T02:01:59.000Z</published>
    <updated>2020-01-31T02:12:09.969Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1295/problem/E" target="_blank" rel="noopener">#1295E. Permutation Separation</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>给定一个 $1-n$ 的排列。将该排列划分为非空的前后缀，要求在两个集合间移动一些元素，其中移动第 $i$ 个元素的代价为 $a_i$，使得在前缀集合中的所有元素均小于后缀集合中的任意元素。</p><p>$n\le 2e5,a_i\le 1e9$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>记变量 $val$ 表示将 $1-val$ 移至前缀集合，将 $(val+1)-n$ 移至后缀集合。记 $t[pos]$ 表示将排列划分为 $1-pos,(pos+1)-n$ 所花费的代价。</p><p>考虑当 $val$ 增加 $1$ 时，$t$ 数组的变化，可以用线段树维护。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>竟然一遍写对线段树我好开心 qwq</p><p>如果遇到障碍，可以转化值域定义再次尝试，重新确定枚举对象。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson(u) node[u].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson(u) node[u].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> val(u) node[u].val</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tag(u) node[u].tag</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">1e16</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    ll val, tag;</span><br><span class="line">&#125; node[MAXN &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>, R = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, p[MAXN], b[MAXN];</span><br><span class="line">ll a[MAXN], t[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    val(u) = min(val(lson(u)), val(rson(u)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag(u)) &#123;</span><br><span class="line">        val(lson(u)) += tag(u);</span><br><span class="line">        val(rson(u)) += tag(u);</span><br><span class="line">        tag(lson(u)) += tag(u);</span><br><span class="line">        tag(rson(u)) += tag(u);</span><br><span class="line">        tag(u) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span>&amp; u, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    u = ++cnt;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        val(u) = t[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    build(lson(u), l, mid), build(rson(u), mid + <span class="number">1</span>, r);</span><br><span class="line">    pushup(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr, ll val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) &#123;</span><br><span class="line">        tag(u) += val;</span><br><span class="line">        val(u) += val;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(u);</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) modify(lson(u), l, mid, ql, qr, val);</span><br><span class="line">    <span class="keyword">if</span> (mid &lt; qr) modify(rson(u), mid + <span class="number">1</span>, r, ql, qr, val);</span><br><span class="line">    pushup(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p[i]), b[p[i]] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">"%I64d"</span>, &amp;a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">1</span>; ++i) t[i] = t[i - <span class="number">1</span>] + a[i];</span><br><span class="line">    ll ans = t[<span class="number">1</span>];</span><br><span class="line">    build(R, <span class="number">1</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> pos = b[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> &lt;= pos - <span class="number">1</span>)</span><br><span class="line">            modify(R, <span class="number">1</span>, n - <span class="number">1</span>, <span class="number">1</span>, pos - <span class="number">1</span>, a[pos]);</span><br><span class="line">        <span class="keyword">if</span> (pos &lt;= n - <span class="number">1</span>)</span><br><span class="line">            modify(R, <span class="number">1</span>, n - <span class="number">1</span>, pos, n - <span class="number">1</span>, -a[pos]);</span><br><span class="line">        ans = min(ans, val(R));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%I64d"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://codeforces.com/contest/1295/problem/E&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#1295E. Permutation Separation&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;给定一个 $1-n$ 的排列。将该排列划分为非空的前后缀，要求在两个集合间移动一些元素，其中移动第 $i$ 个元素的代价为 $a_i$，使得在前缀集合中的所有元素均小于后缀集合中的任意元素。&lt;/p&gt;
&lt;p&gt;$n\le 2e5,a_i\le 1e9$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="线段树" scheme="https://tth37.cn/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>「随记」hexo-inject 插件的使用</title>
    <link href="https://tth37.cn/2020/01/30/diary-inject/"/>
    <id>https://tth37.cn/2020/01/30/diary-inject/</id>
    <published>2020-01-30T10:35:47.000Z</published>
    <updated>2020-01-30T10:43:17.758Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="Hey, password is required here." />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="beaf3d259935413368477976f02ed40f849690febcd4d3e682a40b5d8f9e2841">ab7361b866f8ec82505a42a0d75e0738006b075f6e62674312162b60881084fb68f2058d7c237ab2ee7fb6fe3ebcf5d18004c72027a2644f13169c41fea111a849a1692e775ba0f40dd026f42a8d33f981fa2594ccc4f6bbbc1b318ef289b00bd3fa2bfb6d6ec89842857925b2b8911df14766ececa9fc0cc3166de323ed6c694cb06974eb75efd18af8ee737ad8e3f234dc9fa20ef6518ca3311c7368dad1042a87389b1567250545f4a497231f6ccfd35f6cf761f59d7a4675aabc97f09ab8c26725a4ae4f702cd3f12d72ed2d0d3df029fde0bf96a780a632eb3da5367b1c6949ac03769debbd088a64dd6370ece43e4ed4d125e2f38356e092d4809f8aa106665ba2b7388db836c509db42043f6f97c31fc4ce95c4457626ae87613dd1068a61f7e0417db3c6b285b580dc64bec6674b81e083fa263ed0860a8b2c70f4a00fc0383b9d806eda1095574a2e884718fe373568ac9d8df2641c4c6413fd86bb018ed1a7b501e2e76137818b829cc0aa359923a2a4e5e66f814230c1f59fcc73242608e2ed6a6f04c63e391201efb0b24df1869a1d852cb5682092d1476d9450f991ee5042c9935d4d9e635c9c99df5505eadfb06fad4d6e33e6e514612a4ce18614cf4a234405365d0803a14987d90a96cb3caed6d2b9374929ae8d280416569113f9d5154a6d45e78a6bc4100db466c171294c7d1000d783e4e534e066df5e3401aaa4e50330288f2cf6a723601d9eaea908083a379a75678703933a986fea2562f10b922801dfbc52937c196b48504ddf743515b29538be5d0f5e38d467f8855c24ab98f6cc863e2cc289c687527664d3c8255505e5a368dc15f28300369d0785b871090da517cfeb0b51ec820c9eb334fa332dac3f44edd5d73ac888986dbc4f0267a5a72cea994710124480469190e1d18ae1bad94294e2c71fdedd51ff0863481a7f557fdb7fd991773344630d8a3e3a92cbf143c715ac2c27ea39b3a346c3cef295767d1078d8a890f546cce9afa698575bf4b0ca3e21929d32876a254720c72f82d64f860bbc13c9930f2cd069d4818a3775a5ebf583adf12a12320c6b2dcacb3f0e0746a350c40f540b4178f9791947f611393545f61805f62a79c46e0ec2c33fe0a749529c1098e04c18e6</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      关于 html 渲染植入代码问题
    
    </summary>
    
      <category term="随记" scheme="https://tth37.cn/categories/%E9%9A%8F%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>网络流</title>
    <link href="https://tth37.cn/2020/01/30/algorithm-flow/"/>
    <id>https://tth37.cn/2020/01/30/algorithm-flow/</id>
    <published>2020-01-30T03:53:37.000Z</published>
    <updated>2020-02-28T15:25:20.124Z</updated>
    
    <content type="html"><![CDATA[<details><summary>玩一玩 details 标签！</summary><p> 内容在这里！</p></details><blockquote><p>本文部分内容来自 <a href="https://oi-wiki.org/graph/flow/bound/" target="_blank" rel="noopener">OI-Wiki</a> 相关章节</p></blockquote><a id="more"></a><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><h4 id="Dinic-最大流（多路增广-当前弧优化）"><a href="#Dinic-最大流（多路增广-当前弧优化）" class="headerlink" title="Dinic 最大流（多路增广+当前弧优化）"></a>Dinic 最大流（多路增广+当前弧优化）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1205</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">120005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nxt;</span><br><span class="line">    ll w;</span><br><span class="line">&#125; edge[MAXM &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN], cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> head_or[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, ll w)</span> </span>&#123;</span><br><span class="line">    edge[++cnt].w = w;</span><br><span class="line">    edge[cnt].v = v;</span><br><span class="line">    edge[cnt].nxt = head_or[u];</span><br><span class="line">    head_or[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="built_in">memcpy</span>(head, head_or, <span class="keyword">sizeof</span>(head));</span><br><span class="line">    vis[s] = <span class="number">1</span>, d[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="keyword">while</span> (q.size()) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            ll w = edge[i].w;</span><br><span class="line">            <span class="keyword">if</span> (vis[v] || (w == <span class="number">0</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            vis[v] = <span class="number">1</span>;</span><br><span class="line">            d[v] = d[u] + <span class="number">1</span>;</span><br><span class="line">            q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vis[t];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, ll flow)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">    ll rest = flow;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i &amp;&amp; rest; i = edge[i].nxt) &#123;</span><br><span class="line">        head[u] = i;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        ll w = edge[i].w;</span><br><span class="line">        <span class="keyword">if</span> (w == <span class="number">0</span> || d[v] != d[u] + <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        ll tmp = dfs(v, min(rest, w));</span><br><span class="line">        <span class="keyword">if</span> (tmp == <span class="number">0</span>) d[v] = <span class="number">0</span>;</span><br><span class="line">        edge[i].w -= tmp;</span><br><span class="line">        edge[i ^ <span class="number">1</span>].w += tmp;</span><br><span class="line">        rest -= tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow - rest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ret = <span class="number">0</span>, tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (bfs())</span><br><span class="line">        <span class="keyword">while</span> (tmp = dfs(s, INF)) ret += tmp;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;s, &amp;t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;u, &amp;v, &amp;c);</span><br><span class="line">        AddEdge(u, v, c), AddEdge(v, u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>, dinic());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="类-Dinic-费用流"><a href="#类-Dinic-费用流" class="headerlink" title="类 Dinic 费用流"></a>类 Dinic 费用流</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">50005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t, ans;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nxt, w, c;</span><br><span class="line">&#125; edge[MAXM &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN], cnt = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    edge[++cnt].w = w;</span><br><span class="line">    edge[cnt].v = v;</span><br><span class="line">    edge[cnt].c = c;</span><br><span class="line">    edge[cnt].nxt = head[u];</span><br><span class="line">    head[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> d[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(d));</span><br><span class="line">    vis[s] = <span class="number">1</span>, d[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="keyword">while</span> (q.size()) &#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = edge[i].nxt) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">            <span class="keyword">int</span> w = edge[i].w, c = edge[i].c;</span><br><span class="line">            <span class="keyword">if</span> (w != <span class="number">0</span> &amp;&amp; d[u] + c &lt; d[v]) &#123;</span><br><span class="line">                d[v] = d[u] + c;</span><br><span class="line">                <span class="keyword">if</span> (vis[v] == <span class="number">0</span>) q.push(v), vis[v] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[t] != INF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">    vis[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> rest = flow;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i &amp;&amp; rest; i = edge[i].nxt) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">int</span> w = edge[i].w, c = edge[i].c;</span><br><span class="line">        <span class="keyword">if</span> (vis[v] || w == <span class="number">0</span> || d[v] != d[u] + c) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = dfs(v, min(rest, w));</span><br><span class="line">        <span class="keyword">if</span> (tmp == <span class="number">0</span>) d[v] = INF;</span><br><span class="line">        edge[i].w -= tmp;</span><br><span class="line">        edge[i ^ <span class="number">1</span>].w += tmp;</span><br><span class="line">        rest -= tmp;</span><br><span class="line">        ans += c * tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    vis[u] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow - rest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>, tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (spfa()) &#123;</span><br><span class="line">        <span class="keyword">while</span> (tmp = dfs(s, INF)) ret += tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">    s = <span class="number">1</span>, t = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v, w, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;u, &amp;v, &amp;w, &amp;c);</span><br><span class="line">        AddEdge(u, v, w, c), AddEdge(v, u, <span class="number">0</span>, -c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> maxflow = dinic();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>, maxflow, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="建模方法"><a href="#建模方法" class="headerlink" title="建模方法"></a>建模方法</h3><h4 id="无源汇上下界可行流"><a href="#无源汇上下界可行流" class="headerlink" title="无源汇上下界可行流"></a>无源汇上下界可行流</h4><p>给定无源汇流量网络 G。询问是否存在一种标定每条边流量的方式，使得每条边流量满足上下界同时每一个点流量平衡。</p><p>不妨假设每条边已经流了 $b(u,v)$ 的流量，设其为初始流。同时我们在新图中加入 u 连向 v 的流量为 $c(u,v) - b(u,v)$ 的边。考虑在新图上进行调整。</p><p>由于最大流需要满足初始流量平衡条件（最大流可以看成是下界为 0 的上下界最大流），但是构造出来的初始流很有可能不满足初始流量平衡。假设一个点初始流出流量 - 初始流入流量为 M。</p><p>若 M=0，此时流量平衡，不需要额外边。</p><p>若 M&gt;0，此时出流量过大，需要新建附加源点 SS，SS 向其连流量为 M 的附加边。</p><p>若 M&lt;0，此时入流量过大，需要新建附加汇点 TT，其向 TT 连流量为 -M 的附加边。</p><p>如果附加边满流，说明这一个点的流量平衡条件可以满足，否则这个点的流量平衡条件不满足。（因为附加流满足流量平衡）</p><p>在建图完毕之后跑 S 到 T 的最大流，若 S 连出去的边全部满流，则存在可行流，否则不存在。</p><h4 id="有源汇上下界可行流"><a href="#有源汇上下界可行流" class="headerlink" title="有源汇上下界可行流"></a>有源汇上下界可行流</h4><p>给定有源汇流量网络 G。询问是否存在一种标定每条边流量的方式，使得每条边流量满足上下界同时除了源点和汇点每一个点流量平衡。</p><p>假设源点为 S，汇点为 T。</p><p>则我们可以加入一条 T 到 S 的上界 $\inf$ 下界为 0 的边转化为无源汇上下界可行流问题。</p><p>若有解，则 S 到 T 的可行流流量等于 T 到 S 的附加边的流量。</p><h4 id="有源汇上下界最大流"><a href="#有源汇上下界最大流" class="headerlink" title="有源汇上下界最大流"></a>有源汇上下界最大流</h4><p>给定有源汇流量网络 G。询问是否存在一种标定每条边流量的方式，使得每条边流量满足上下界同时除了源点和汇点每一个点流量平衡。如果存在，询问满足标定的最大流量。</p><p>我们找到网络上的任意一个可行流。如果找不到解就可以直接结束。</p><p>否则我们考虑删去所有额外边之后的残量网络并且在网络上进行调整。</p><p>我们在残量网络上再跑一次 S 到 T 的最大流，将可行流流量和最大流流量相加即为答案。</p><h4 id="有源汇上下界最小流"><a href="#有源汇上下界最小流" class="headerlink" title="有源汇上下界最小流"></a>有源汇上下界最小流</h4><p>给定有源汇流量网络 G。询问是否存在一种标定每条边流量的方式，使得每条边流量满足上下界同时除了源点和汇点每一个点流量平衡。如果存在，询问满足标定的最小流量。</p><p>类似的，我们考虑将残量网络中不需要的流退掉。</p><p>我们找到网络上的任意一个可行流。如果找不到解就可以直接结束。</p><p>否则我们考虑删去所有额外边之后的残量网络。</p><p>我们在残量网络上再跑一次 T 到 S 的最大流，将可行流流量减去最大流流量即为答案。</p>]]></content>
    
    <summary type="html">
    
      &lt;details&gt;
&lt;summary&gt;玩一玩 details 标签！&lt;/summary&gt;
&lt;p&gt; 内容在这里！&lt;/p&gt;
&lt;/details&gt;

&lt;blockquote&gt;
&lt;p&gt;本文部分内容来自 &lt;a href=&quot;https://oi-wiki.org/graph/flow/bound/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;OI-Wiki&lt;/a&gt; 相关章节&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="算法学习" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="图论" scheme="https://tth37.cn/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E5%9B%BE%E8%AE%BA/"/>
    
    
      <category term="网络流" scheme="https://tth37.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>「CF1295」Same GCDs</title>
    <link href="https://tth37.cn/2020/01/30/solution-cf-1295d/"/>
    <id>https://tth37.cn/2020/01/30/solution-cf-1295d/</id>
    <published>2020-01-30T01:50:16.000Z</published>
    <updated>2020-01-30T14:52:52.439Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1295/problem/D" target="_blank" rel="noopener">#1295D. Same GCDs</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>给定正整数 $a$，$m$（$a&lt;m$）。计算符合条件的 $x\in[0,m)$ 的个数，使得 $\text{gcd}(a,m)=\text{gcd}(a+x,m)$。</p><p>$a\le 1e10,m\le 1e10$</p><a id="more"></a><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution 1"></a>Solution 1</h3><p>记 $a+x=y$。题目即为求复合条件的 $y\in[a,a+m)$ 使得 $\text{gcd}(a,m)=\text{gcd}(y,m)$。记 $\text{gcd}(a,m)=g$。可以发现，$y$ 可以表示为 $kg$，其中 $k$ 的取值范围为 $[l,r],l=\lceil\frac{a}{g}\rceil,r=\lceil\frac{a+m}{g}\rceil-1$。观察到 $\text{gcd}(kg,m)=g$，即 $\text{gcd}(k,m/g)=1$，$k$ 与 $m/g$ 互质。记 $\texttt{solve(n,m)}$ 函数为 $1-n$ 的整数中与 $m$ 互质的数的个数，则本题答案为 $\texttt{solve(r,m/g)-solve(l-1,m/g)}$。</p><p>接下来考虑 $\texttt{solve()}$ 函数的设计。注意到一个 $1e10$ 级别的数最多只有 10 个质因子，因此可以使用状态压缩和容斥原理计算出 $1-n$ 中与 $m$ 不互质的数的个数。</p><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution 2"></a>Solution 2</h3><p>有 $\text{gcd}((a+x)%m,m)=\text{gcd}(a,m)$。注意到当 $x\in[0,m)$ 时，$(a+x)%m$ 的值取遍 $[0,m)$。换言之，我们只需计算符合条件的 $y\in[0,m)$ 使得 $\text{gcd}(y,m)=gcd(a,m)$。记 $\text{gcd}(a,m)=g$，即 $\text{gcd}(y/g,m/g)=1$，即 $\varphi(m/g)$。计算欧拉函数即可。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>不能感性理解！要把式子推出来</p><h3 id="Code-1"><a href="#Code-1" class="headerlink" title="Code 1"></a>Code 1</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max(a, b) (a &gt; b ? a : b)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> min(a, b) (a &gt; b ? b : a)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readint</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span>... <span class="title">T2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">readint</span>(<span class="title">T1</span> &amp;<span class="title">i</span>, <span class="title">T2</span> &amp;... <span class="title">rest</span>) &#123;</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">bool</span> f = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c = getchar())) f = c == <span class="string">'-'</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        i = (i &lt;&lt; <span class="number">3</span>) + (i &lt;&lt; <span class="number">1</span>) + c - <span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c = getchar()));</span><br><span class="line">    <span class="keyword">if</span> (f)</span><br><span class="line">        i = -i;</span><br><span class="line">    readint(rest...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">solve</span><span class="params">(ll n, ll m)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;ll&gt; p;</span><br><span class="line">    <span class="keyword">for</span> (ll i = <span class="number">2</span>; i * i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (m % i == <span class="number">0</span>) &#123;</span><br><span class="line">            p.push_back(i);</span><br><span class="line">            <span class="keyword">while</span> (m % i == <span class="number">0</span>) m /= i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (m &gt; <span class="number">1</span>) p.push_back(m);</span><br><span class="line">    ll ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll s = <span class="number">1</span>; s &lt; (<span class="number">1</span> &lt;&lt; p.size()); ++s) &#123;</span><br><span class="line">        ll mult = <span class="number">1</span>, bits = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p.size(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s &amp; (<span class="number">1l</span>l &lt;&lt; i)) &#123;</span><br><span class="line">                bits++;</span><br><span class="line">                mult *= p[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ll cur = n / mult;</span><br><span class="line">        <span class="keyword">if</span> (bits &amp; <span class="number">1</span>) ret += cur;</span><br><span class="line">        <span class="keyword">else</span> ret -= cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n - ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    readint(T);</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        ll a, m;</span><br><span class="line">        readint(a, m);</span><br><span class="line">        ll g = __gcd(a, m);</span><br><span class="line">        ll l = a / g + (a % g != <span class="number">0</span>), r = (a + m) / g - ((a + m) % g == <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>, solve(r, m / g) - solve(l - <span class="number">1</span>, m / g));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Code-2"><a href="#Code-2" class="headerlink" title="Code 2"></a>Code 2</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">phi</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    ll ret = n;</span><br><span class="line">    <span class="keyword">for</span> (ll i = <span class="number">2</span>; i * i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>) ret = ret / i * (i - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (n % i == <span class="number">0</span>) n /= i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) ret = ret / n * (n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        ll a, m;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; a &gt;&gt; m;</span><br><span class="line">        ll g = __gcd(a, m);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; phi(m / g) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://codeforces.com/contest/1295/problem/D&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#1295D. Same GCDs&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;给定正整数 $a$，$m$（$a&amp;lt;m$）。计算符合条件的 $x\in[0,m)$ 的个数，使得 $\text{gcd}(a,m)=\text{gcd}(a+x,m)$。&lt;/p&gt;
&lt;p&gt;$a\le 1e10,m\le 1e10$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="数学" scheme="https://tth37.cn/tags/%E6%95%B0%E5%AD%A6/"/>
    
      <category term="数论" scheme="https://tth37.cn/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="容斥原理" scheme="https://tth37.cn/tags/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86/"/>
    
      <category term="状态压缩" scheme="https://tth37.cn/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/"/>
    
      <category term="欧拉函数" scheme="https://tth37.cn/tags/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>「SDOI2019」热闹的聚会与尴尬的聚会</title>
    <link href="https://tth37.cn/2020/01/29/solution-loj-3113/"/>
    <id>https://tth37.cn/2020/01/29/solution-loj-3113/</id>
    <published>2020-01-29T03:12:21.000Z</published>
    <updated>2020-01-29T06:54:16.232Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://loj.ac/problem/3113" target="_blank" rel="noopener">#3113. 「SDOI2019」热闹的聚会与尴尬的聚会</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p><del>震惊！tth37居然……</del></p><p>给定一个图 $G$， 要求在图中选出一些点组成两个互不相关的子图 $P$，$Q$，其中子图 $Q$ 为原图的一个独立集。记 $P$ 中的节点最小度数为 $p$，$q=|Q|$。要求 $\lfloor\frac{n}{p+1}\rfloor\le q$ 且 $\lfloor\frac{n}{q+1}\rfloor\le p$，输出一种可行方案。</p><p>$n\le 1e5,m\le 1e5$</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>对题意进行转化，$\frac{n}{p+1}&lt;\lfloor\frac{n}{p+1}\rfloor+1\le q+1$，$n&lt;(p+1)(q+1)$。</p><p>考虑如下构造方法：第 $i$ 次操作中选取当前剩余图中度数最小的节点，记其度数为 $d_i$、节点编号为 $a_i$，将该节点及其相邻的节点删去。重复上述操作，直至图中没有剩余节点，设该操作重复 $q$ 次。</p><p>不难发现 $\lbrace a_i\rbrace$ 为独立集，可以将 $\lbrace a_i\rbrace$ 加入集合 $Q$。取 $d_m=\max\lbrace d_i\rbrace$，换言之剩余图中最小节点度数的最大值为 $d_m$。将第 $m$ 次及以后删除的点加入集合 $P$，则 $p=d_m$。此时 $q\times (d_m+1)\ge n$，原式显然成立。</p><p>用线段树维护度数最小的节点。</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readint</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T1</span>, <span class="title">class</span> ...<span class="title">T2</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">readint</span>(<span class="title">T1</span> &amp;<span class="title">i</span>, <span class="title">T2</span>&amp;... <span class="title">rest</span>)&#123;</span></span><br><span class="line">    i=<span class="number">0</span>;<span class="keyword">char</span> c;<span class="keyword">bool</span> f=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c=getchar())) f=c==<span class="string">'-'</span>;</span><br><span class="line">    <span class="keyword">do</span> i=(i&lt;&lt;<span class="number">3</span>)+(i&lt;&lt;<span class="number">1</span>)+c-<span class="string">'0'</span>; <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c=getchar()));</span><br><span class="line">    <span class="keyword">if</span> (f) i=-i;</span><br><span class="line">    readint(rest...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t, n, m, d[MAXN], sum;</span><br><span class="line"><span class="keyword">bool</span> del[MAXN];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAXN], P[MAXN], Q;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segment_Tree</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson(u) node[u].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson(u) node[u].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> val(u) node[u].val</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pos(u) node[u].pos</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> l, r, val, pos;</span><br><span class="line">    &#125; node[MAXN &lt;&lt; <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> R, cnt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">        val(u) = min(val(lson(u)), val(rson(u)));</span><br><span class="line">        <span class="keyword">if</span> (val(lson(u)) == val(u)) pos(u) = pos(lson(u));</span><br><span class="line">        <span class="keyword">else</span> pos(u) = pos(rson(u));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span>&amp; u, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        u = ++cnt;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            val(u) = d[l];</span><br><span class="line">            pos(u) = l;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        build(lson(u), l, mid), build(rson(u), mid + <span class="number">1</span>, r);</span><br><span class="line">        pushup(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            val(u) += val;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (p &lt;= mid) modify(lson(u), l, mid, p, val);</span><br><span class="line">        <span class="keyword">else</span> modify(rson(u), mid + <span class="number">1</span>, r, p, val);</span><br><span class="line">        pushup(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    readint(t);</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        readint(n, m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            readint(u, v);</span><br><span class="line">            G[u].push_back(v), G[v].push_back(u);</span><br><span class="line">            d[u]++, d[v]++;</span><br><span class="line">        &#125;</span><br><span class="line">        T.build(T.R, <span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">int</span> max_val = <span class="number">0</span>, max_pos = <span class="number">0</span>, cur_pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (sum ^ n) &#123;</span><br><span class="line">            cur_pos++;</span><br><span class="line">            <span class="keyword">int</span> u = T.pos(T.R);</span><br><span class="line">            <span class="keyword">if</span> (T.val(T.R) &gt; max_val) &#123;</span><br><span class="line">                max_val = T.val(T.R), max_pos = cur_pos;</span><br><span class="line">          &#125;</span><br><span class="line">            Q.push_back(u), P[cur_pos].push_back(u);</span><br><span class="line">            del[u] = <span class="number">1</span>, T.modify(T.R, <span class="number">1</span>, n, u, INF), sum++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[u]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (del[v]) <span class="keyword">continue</span>;</span><br><span class="line">                P[cur_pos].push_back(v);</span><br><span class="line">                del[v] = <span class="number">1</span>, T.modify(T.R, <span class="number">1</span>, n, v, INF), sum++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> w : G[v]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (del[w]) <span class="keyword">continue</span>;</span><br><span class="line">                    T.modify(T.R, <span class="number">1</span>, n, w, <span class="number">-1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> p_cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = max_pos; i &lt;= cur_pos; ++i)</span><br><span class="line">            p_cnt += P[i].size();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, p_cnt);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = max_pos; i &lt;= cur_pos; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> u : P[i])</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d "</span>, u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, cur_pos);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> u : Q)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>, u);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">        T.cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            G[i].clear(), P[i].clear();</span><br><span class="line">        Q.clear();</span><br><span class="line">        <span class="built_in">memset</span>(del, <span class="number">0</span>, <span class="keyword">sizeof</span>(del));</span><br><span class="line">        <span class="built_in">memset</span>(d, <span class="number">0</span>, <span class="keyword">sizeof</span>(d));</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://loj.ac/problem/3113&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#3113. 「SDOI2019」热闹的聚会与尴尬的聚会&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;&lt;del&gt;震惊！tth37居然……&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;给定一个图 $G$， 要求在图中选出一些点组成两个互不相关的子图 $P$，$Q$，其中子图 $Q$ 为原图的一个独立集。记 $P$ 中的节点最小度数为 $p$，$q=|Q|$。要求 $\lfloor\frac{n}{p+1}\rfloor\le q$ 且 $\lfloor\frac{n}{q+1}\rfloor\le p$，输出一种可行方案。&lt;/p&gt;
&lt;p&gt;$n\le 1e5,m\le 1e5$&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="LibreOJ" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/LibreOJ/"/>
    
    
      <category term="线段树" scheme="https://tth37.cn/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="构造" scheme="https://tth37.cn/tags/%E6%9E%84%E9%80%A0/"/>
    
  </entry>
  
  <entry>
    <title>创造</title>
    <link href="https://tth37.cn/2020/01/23/solution-jsk-6010B/"/>
    <id>https://tth37.cn/2020/01/23/solution-jsk-6010B/</id>
    <published>2020-01-23T13:28:56.000Z</published>
    <updated>2020-01-23T13:36:54.520Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/43129" target="_blank" rel="noopener">#43129. 创造</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>题目概括征集中~</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>出现问题。莫名 RE。待更</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/43129&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#43129. 创造&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;题目概括征集中~&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="欧拉路" scheme="https://tth37.cn/tags/%E6%AC%A7%E6%8B%89%E8%B7%AF/"/>
    
  </entry>
  
  <entry>
    <title>灭绝</title>
    <link href="https://tth37.cn/2020/01/23/solution-jsk-6010A/"/>
    <id>https://tth37.cn/2020/01/23/solution-jsk-6010A/</id>
    <published>2020-01-23T13:28:16.000Z</published>
    <updated>2020-01-23T13:35:05.939Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://nanti.jisuanke.com/t/43128" target="_blank" rel="noopener">#43128. 灭绝</a></p><h3 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h3><p>题目概括征集中~</p><a id="more"></a><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>自 <a href="http://localhost:4000/2019/08/23/solution-luogu-uva11021/" target="_blank" rel="noopener">麻球繁衍</a> 改编而来。</p><p>状态转移方程：</p><p>$$<br>f[i]=\sum_{j=1}^mp_i\times f[i-t_i]^{s_i}<br>$$</p><p>需要注意灭绝的边界情况讨论。</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>取模要取干净！</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = ret * x % MOD;</span><br><span class="line">        x = x * x % MOD;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, l, m;</span><br><span class="line"><span class="keyword">int</span> q[<span class="number">2005</span>], t[<span class="number">2005</span>], s[<span class="number">2005</span>];</span><br><span class="line">ll sum_q = <span class="number">0</span>;</span><br><span class="line">ll inv_sum_q = <span class="number">0</span>;</span><br><span class="line">ll p[<span class="number">2005</span>];</span><br><span class="line">ll f[<span class="number">2005</span>];</span><br><span class="line">ll ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;l, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;q[i], &amp;t[i], &amp;s[i]);</span><br><span class="line">        sum_q += q[i];</span><br><span class="line">    &#125;</span><br><span class="line">    inv_sum_q = qpow(sum_q, MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">        p[i] = <span class="number">1l</span>l * q[i] * inv_sum_q % MOD; <span class="comment">// 取模！</span></span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= l; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i - t[j] &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (i - t[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s[j] == <span class="number">0</span>)</span><br><span class="line">                    f[i] = (f[i] + p[j]) % MOD;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            f[i] = (f[i] + p[j] * qpow(f[i - t[j]], s[j]) % MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = qpow(f[l], n);</span><br><span class="line">    ans = (<span class="number">1l</span>l - ans + MOD) % MOD;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://nanti.jisuanke.com/t/43128&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;#43128. 灭绝&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h3&gt;&lt;p&gt;题目概括征集中~&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="计蒜客" scheme="https://tth37.cn/categories/%E9%A2%98%E8%A7%A3/%E8%AE%A1%E8%92%9C%E5%AE%A2/"/>
    
    
      <category term="概率" scheme="https://tth37.cn/tags/%E6%A6%82%E7%8E%87/"/>
    
  </entry>
  
</feed>
